import redis

from crawler.config import settings

# 初始化 Redis 连接
r = redis.from_url(settings.redis_dsn, decode_responses=True, protocol=3)


def delete_keys_by_pattern(pattern: str):
    """
    删除所有匹配模式的键
    :param pattern: 匹配模式
    """
    cursor = "0"
    while cursor != 0:
        cursor, keys = r.scan(cursor=cursor, match=pattern, count=1000)
        if keys:
            r.delete(*keys)
            print(f"Deleted {len(keys)} keys")


products = [
    "545906002",
    "883550062",
    "409146032",
    "500584012",
    "508982002",
    "438023002",
    "411679012",
    "568218182",
    "431842002",
    "416638062",
    "260636432",
    "403540002",
    "728863002",
    "871386002",
    "1000185002",
    "869730052",
    "869726132",
    "558957002",
    "855967032",
    "356168652",
    "871336002",
    "729618122",
    "821866002",
    "880266022",
    "540687002",
    "568217092",
    "880878002",
    "875081002",
    "563012002",
    "869722092",
    "260230112",
    "406725002",
    "794579002",
    "803567002",
    "570868002",
    "1000191002",
    "429165002",
    "660018002",
    "1000187002",
    "448087002",
    "474285002",
    "479461042",
    "794965092",
    "821325052",
    "431253002",
    "407881002",
    "407882002",
    "431248002",
    "431256002",
    "563335002",
    "563007002",
    "562984002",
    "655107002",
    "373509102",
    "729652002",
    "670538042",
    "664665002",
    "586769012",
    "586732002",
    "576561002",
    "536721012",
    "870589022",
    "854755022",
    "890601042",
    "890842002",
    "871357002",
    "855745002",
    "855025002",
    "857632002",
    "905272032",
    "869732002",
    "890860002",
    "729783002",
    "885257002",
    "871372002",
    "464373002",
    "855965012",
    "429014002",
    "540610002",
    "592037022",
    "540609002",
    "523562052",
    "834853112",
    "260277012",
    "873269002",
    "848883292",
    "447979002",
    "659618002",
    "871510002",
    "540613002",
    "540615042",
    "841725002",
    "586039002",
    "431159002",
    "585582012",
    "1000130002",
    "857615012",
    "480071002",
    "889933002",
    "876107042",
    "803528002",
    "857272002",
    "871438002",
    "763097042",
    "790890012",
    "873500002",
    "853476002",
    "891995002",
    "540664002",
    "885270012",
    "755814342",
    "586063002",
    "870580002",
    "661059042",
    "871390002",
    "1000184002",
    "1000186002",
    "855189012",
    "592231052",
    "855740002",
    "558870002",
    "711766002",
    "431230002",
    "883001002",
    "504521002",
    "562295002",
    "410052002",
    "409151002",
    "871323002",
    "873266002",
    "857646002",
    "432356012",
    "806999002",
    "409154102",
    "873616002",
    "749402002",
    "1000189002",
    "1000196002",
    "558943002",
    "558851002",
    "871509002",
    "853453002",
    "855181002",
    "570975002",
    "1000193002",
    "1000195002",
    "474278002",
    "474300002",
    "475858002",
    "448029002",
    "1000135002",
    "1000136002",
    "468180002",
    "467557002",
    "443611002",
    "558861002",
    "562980002",
    "562999002",
    "563004002",
    "562982002",
    "469007002",
    "539614072",
    "569554002",
    "855193002",
    "854731022",
    "869173002",
    "563344002",
    "563377002",
    "875076002",
    "790919002",
    "870565002",
    "810502002",
    "729367012",
    "866810022",
    "838328002",
    "892218002",
    "885267002",
    "883004002",
    "884446002",
    "884441002",
    "882985002",
    "431601002",
    "871493002",
    "873397002",
    "464370002",
    "756653002",
    "570424002",
    "665864002",
    "882138002",
    "523563052",
    "891557002",
    "570479002",
    "873496002",
    "854613002",
    "852795002",
    "802546112",
    "570098002",
    "586765002",
    "772532002",
    "406849002",
    "853466002",
    "977167012",
    "570471002",
    "484999002",
    "803547002",
    "875997002",
    "860146032",
    "853455002",
    "857259002",
    "703503002",
    "853367002",
    "728757002",
    "571079002",
    "725276002",
    "817987002",
    "474292002",
    "1000194002",
    "448104002",
    "1000139002",
    "448163002",
    "438382002",
    "467558002",
    "431194002",
    "563359002",
    "562986002",
    "563002002",
    "563028002",
    "570930002",
    "514109012",
    "409147012",
    "586767002",
    "876171042",
    "875131002",
    "821307032",
    "607068022",
    "885306002",
    "790823002",
    "728756002",
    "801175082",
    "586771012",
    "570657032",
    "880359002",
    "870049002",
    "508797002",
    "870045002",
    "870308012",
    "891308002",
    "433077002",
    "484774002",
    "538544002",
    "703536002",
    "767285112",
    "853484002",
    "431270002",
    "607134002",
    "853372002",
    "852810002",
    "871457002",
    "853472002",
    "416427002",
    "615913002",
    "451501022",
    "431236002",
    "853457002",
    "541190062",
    "1169518002",
    "1169504002",
    "448066002",
    "571390002",
    "564498002",
    "475981002",
    "521943002",
    "479573002",
    "664970012",
    "409122022",
    "742352002",
    "721402002",
    "876170002",
    "876173002",
    "872134002",
    "872139002",
    "803676002",
    "876183002",
    "876282002",
    "876278002",
    "404582032",
    "708566012",
    "795299002",
    "729770002",
    "810824012",
    "708824052",
    "565000012",
    "880336012",
    "706814022",
    "540641002",
    "513541002",
    "876046002",
    "771691022",
    "825962012",
    "825968052",
    "819065042",
    "754014012",
    "851358002",
    "876195002",
    "736395022",
    "851299002",
    "745051012",
    "1169505002",
    "1169506002",
    "1169503002",
    "1169502002",
    "728747002",
    "709931002",
    "876255002",
    "826477002",
    "876176002",
    "709337012",
    "876264002",
    "505871002",
    "742330022",
    "792265012",
    "866823002",
    "1000243002",
    "1000246002",
    "835830002",
    "569075002",
    "542723012",
    "542894002",
    "670622032",
    "601259002",
    "741321052",
    "753357002",
    "778551002",
    "778679002",
    "682533012",
    "851343002",
    "851357002",
    "876280002",
    "569147002",
    "750149002",
    "708564022",
    "797975002",
    "795303002",
    "542693122",
    "542783002",
    "662339022",
    "873614002",
    "876325002",
    "446507002",
    "586766002",
    "794580012",
    "818313002",
    "873494002",
    "409527012",
    "1000249002",
    "563005002",
    "880265002",
    "816860022",
    "416417002",
    "513506002",
    "463709032",
    "415800042",
    "231856572",
    "706808062",
    "664974002",
    "790822002",
    "816857002",
    "795344012",
    "795398032",
    "857725002",
    "824315022",
    "823165002",
    "823673002",
    "684836022",
    "814639002",
    "795345022",
]
for product in products:
    pattern = f"image_status:gap:women:default*:{product}*"
    delete_keys_by_pattern(pattern)
