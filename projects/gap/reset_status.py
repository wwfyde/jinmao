import redis

from crawler.config import settings

# 初始化 Redis 连接
r = redis.from_url(settings.redis_dsn, decode_responses=True, protocol=3)


def delete_keys_by_pattern(pattern: str):
    """
    删除所有匹配模式的键
    :param pattern: 匹配模式
    """
    cursor = "0"
    while cursor != 0:
        cursor, keys = r.scan(cursor=cursor, match=pattern, count=1000)
        if keys:
            r.delete(*keys)
            print(f"Deleted {len(keys)} keys")


products = [
    "795346",
    "883550",
    "409146",
    "500584",
    "508982",
    "438023",
    "411679",
    "568218",
    "431842",
    "416638",
    "260636",
    "403540",
    "818866",
    "794565",
    "558802",
    "421104",
    "421102",
    "558957",
    "838149",
    "890846",
    "855967",
    "356168",
    "871336",
    "729618",
    "821866",
    "880266",
    "540687",
    "568217",
    "880878",
    "875081",
    "563012",
    "421103",
    "260230",
    "406725",
    "794579",
    "852814",
    "570868",
    "558758",
    "892217",
    "660034",
    "562241",
    "448087",
    "474285",
    "479461",
    "794965",
    "821325",
    "431253",
    "407881",
    "407882",
    "431248",
    "431256",
    "563335",
    "563007",
    "562984",
    "655107",
    "373509",
    "729652",
    "670538",
    "664665",
    "586769",
    "586732",
    "576561",
    "536721",
    "870589",
    "854755",
    "890601",
    "890842",
    "871357",
    "855745",
    "855025",
    "857632",
    "905272",
    "869732",
    "890860",
    "729783",
    "885257",
    "871372",
    "464373",
    "855965",
    "429014",
    "540610",
    "592037",
    "540609",
    "523562",
    "834853",
    "260277",
    "873269",
    "848883",
    "447979",
    "659618",
    "871510",
    "540613",
    "540615",
    "841725",
    "586039",
    "431159",
    "585582",
    "1000130",
    "857615",
    "480071",
    "889933",
    "876107",
    "803528",
    "857272",
    "871438",
    "763097",
    "790890",
    "873500",
    "853476",
    "891995",
    "540664",
    "885270",
    "755814",
    "586063",
    "870580",
    "661059",
    "871390",
    "1000184",
    "1000186",
    "855189",
    "592231",
    "855740",
    "558870",
    "711766",
    "431230",
    "883001",
    "504521",
    "562295",
    "410052",
    "409151",
    "871323",
    "873266",
    "857646",
    "432356",
    "806999",
    "409154",
    "873616",
    "749402",
    "1000189",
    "1000183",
    "558943",
    "559065",
    "794603",
    "570897",
    "855181",
    "703551",
    "1000193",
    "1000195",
    "474278",
    "474300",
    "475858",
    "448029",
    "1000135",
    "1000136",
    "468180",
    "467557",
    "443611",
    "558861",
    "562980",
    "562999",
    "563004",
    "562982",
    "469007",
    "539614",
    "569554",
    "855193",
    "854731",
    "869173",
    "563344",
    "563377",
    "875076",
    "790919",
    "870565",
    "810502",
    "729367",
    "866810",
    "838328",
    "892218",
    "885267",
    "883004",
    "884446",
    "884441",
    "882985",
    "431601",
    "871493",
    "873397",
    "464370",
    "756653",
    "570424",
    "665864",
    "882138",
    "523563",
    "891557",
    "570479",
    "873496",
    "854613",
    "852795",
    "802546",
    "570098",
    "586765",
    "772532",
    "406849",
    "853466",
    "977167",
    "570471",
    "484999",
    "803547",
    "875997",
    "860146",
    "853455",
    "857259",
    "703505",
    "853477",
    "728757",
    "795399",
    "570955",
    "817987",
    "474292",
    "1000194",
    "448104",
    "1000139",
    "448163",
    "438382",
    "467558",
    "431194",
    "563359",
    "562986",
    "563002",
    "563028",
    "570930",
    "514109",
    "409147",
    "586767",
    "876171",
    "875131",
    "821307",
    "607068",
    "885306",
    "790823",
    "728756",
    "801175",
    "586771",
    "570657",
    "880359",
    "870049",
    "508797",
    "870045",
    "870308",
    "891308",
    "433077",
    "484774",
    "538544",
    "703536",
    "767285",
    "853484",
    "431270",
    "607134",
    "853372",
    "852810",
    "871457",
    "853472",
    "416427",
    "615913",
    "451501",
    "891362",
    "431236",
    "853457",
    "541190",
    "1169518",
    "1169504",
    "448066",
    "571390",
    "564498",
    "475981",
    "521943",
    "479573",
    "664970",
    "409122",
    "742352",
    "721402",
    "876170",
    "876173",
    "872134",
    "872139",
    "803676",
    "876183",
    "876282",
    "876278",
    "404582",
    "708566",
    "795299",
    "729770",
    "810824",
    "708824",
    "565000",
    "880336",
    "880339",
    "706814",
    "540641",
    "513541",
    "876046",
    "771691",
    "825962",
    "825968",
    "819065",
    "754014",
    "851358",
    "876195",
    "736395",
    "851299",
    "745051",
    "1169505",
    "1169506",
    "1169503",
    "1169502",
    "728747",
    "709931",
    "876255",
    "826477",
    "876176",
    "709337",
    "876264",
    "505871",
    "742330",
    "792265",
    "866823",
    "1000080",
    "1000245",
    "1000090",
    "798281",
    "569075",
    "542723",
    "542894",
    "670622",
    "601259",
    "741321",
    "753357",
    "778551",
    "778679",
    "682533",
    "851343",
    "851357",
    "876280",
    "569147",
    "750149",
    "708564",
    "797975",
    "795303",
    "542693",
    "542783",
    "662339",
    "873614",
    "876325",
    "446507",
    "586766",
    "SU218894",
    "SU016372",
    "SU335276",
    "SU335255",
    "SU203122",
    "794580",
    "818313",
    "873494",
    "409527",
    "1000249",
    "563005",
    "880265",
    "829184",
    "429892",
    "720206",
    "890849",
    "737296",
    "585699",
    "808188",
    "413831",
    "414188",
    "223627",
    "819602",
    "513718",
    "542715",
    "598134",
    "370404",
    "541613",
    "709142",
    "475979",
    "476471",
    "1169536",
    "431568",
    "855348",
    "471734",
    "796255",
    "468515",
    "417472",
    "412774",
    "440768",
    "468345",
    "468369",
    "417178",
    "429035",
    "401869",
    "472287",
    "431572",
    "476506",
    "870594",
    "870590",
    "556795",
    "472757",
    "405786",
    "598213",
    "613757",
    "736872",
    "715156",
    "880831",
    "497077",
    "401650",
    "507484",
    "448065",
    "472295",
    "888269",
    "881238",
    "514336",
    "405858",
    "465755",
    "412780",
    "465759",
    "442752",
    "440459",
    "880826",
    "880824",
    "467654",
    "468500",
    "448057",
    "448056",
    "855351",
    "238137",
    "881241",
    "468241",
    "401945",
    "797924",
    "471876",
    "401701",
    "401821",
    "881249",
    "442749",
    "468517",
    "471879",
    "468519",
    "870603",
    "468518",
    "544812",
    "507469",
    "876543",
    "881255",
    "881254",
    "428038",
    "1000029",
    "881251",
    "507466",
    "433986",
    "430237",
    "401912",
    "429409",
    "471786",
    "796309",
    "412760",
    "442735",
    "891296",
    "468529",
    "467672",
    "823528",
    "540888",
    "468246",
    "856264",
    "468780",
    "507454",
    "856769",
    "497104",
    "440940",
    "467723",
    "412770",
    "440943",
    "502673",
    "543745",
    "856493",
    "618700",
    "468390",
    "507440",
    "507445",
    "664489",
    "440775",
    "462445",
    "467619",
    "447967",
    "820158",
    "541753",
    "468388",
    "795282",
    "541759",
    "468281",
    "881167",
]
for product in products:
    pattern = f"status:gap:women:default:{product}*"
    delete_keys_by_pattern(pattern)
